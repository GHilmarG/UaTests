
% Island convergence test, no peaks
QAnalytical=14.1372  ; 
T=[20e3     19.856     18.929 ; ...
  15e3      17.2335    14.0225; ...
  10e3      12.956    12.80 ; ...
   7e3      14.1735    14.1156 ; ...
   5e3      13.9296    13.8969 ; ...
   3e3      13.7583    13.7368  ; ...
  2.5e3     14.0719    14.0712 ;  ...
  2e3       14.3021    14.302 ; 
  1e3       14.1412    14.1394 ; ...
  0.5e3     14.1386    14.1389 ; ...
  ] ; 


% Island convergence test, retrograde


T=[20e3       nan     18.929 ; ...
  15e3        nan      14.0225; ...
  10e3         nan      12.80 ; ...
   7e3         nan     14.1156 ; ...
   5e3      13.9007    13.8969 ; ...
   3e3         nan     13.7368  ; ...
  2.5e3        nan     14.0712 ;  ...
  2e3       14.2858    14.302 ; 
  1e3          nan     14.1394 ; ...
  0.5e3        nan     14.1389 ; ...
  ] ; 


% Island convergence test, peaks and retrograde
T=[20e3     20.0729     18.929 ; ...
  15e3        nan      14.0225; ...
  10e3      13.2666      12.80 ; ...
   7e3         nan     14.1156 ; ...
   5e3         nan     13.8969 ; ...   %      16.38 (kmin=k) / nan (kmin=1) /  15.2525(kmin=k0/1e6) / 15.2525 (kmin=k0/1e10 , hwmin=1e-6) / 15.2525 (kmin=k0/1e10 , hwmin=1e-10) / 
   3e3         nan     13.7368  ; ...  %      14.5290 (kmin=k0, hwmin=1e-10) / 14.5295 (kmin=k0/1e10 , hwmin=1e-10) / 14.531 (kmin=k0/1e10, hwmin=1) / 15.15 (kmin=k0, hwmin=1)
  2.5e3        nan     14.0712 ;  ...
  2e3          nan     14.302 ;         %     14.73 (kmin=100 k hwmin=1e-10) / 14.7264 (kmin=0 , hwmin=1e-10)
  1e3          nan     14.1394 ; ...    %     14.2024 (kmin=k0, hwmin=1e-10) / 14.1853 (kmin=k0/1e10 , hwmin=1e-10) / 
  0.5e3        nan    14.1389 ; ...
  ] ; 

% UserVar.Example="-Island-Retrograde-Peaks-aw0-" ; WaterFilmThicknessEquationDriver(UserVar) ;
% CtrlVar.MeshSize=3e3 ;
%  
% qn:`   
% CtrlVar.TriNodes      3                         6        
%                    0.1474 (t=16010)        0.0525 (t=8450) 


figI=FindOrCreateFigure("Island Convergence Test") ; clf(figI)


plot(T(:,1)/1000,T(:,2),"-or")
hold on
plot(T(:,1)/1000,T(:,3),"-*k")
yline(14.137,"--","Analytical",Interpreter="latex")
ylabel("Flux (Gt/yr)",Interpreter="latex")
xlabel("Element size (km)",Interpreter="latex")
legend("$Q_n$: Flux through flux gate","$Q_I$: Input upstream of flux gate",interpreter="latex",location="north")

figRes=FindOrCreateFigure("Island Residual Convergence Test") ; clf(figRes)

colororder({'b','r'})
yyaxis left
semilogy(T(:,1)/1000,abs(T(:,2)-T(:,3))./T(:,3),"-+")
ylabel("$(Q_n-Q_I)/Q_I$",interpreter="latex")

yyaxis right
semilogy(T(:,1)/1000,abs(T(:,2)-QAnalytical)./QAnalytical,"-*")
ylabel("$(Q_n-Q_\mathrm{analytical})/Q_{\mathrm{Analytical}}$",interpreter="latex")
xlabel("Element size (km)",Interpreter="latex")




%%
% this is based on the git commit on 20/03/20-24 at 9:50am
 %l        Qn                  Qint
% 3-node
T= [ ...
25000      0.33            25.1327 ; ...
20000      34.00           25.1327 ; ...
15000      35.72           25.1327 ; ...
12500      30.447          25.1327 ; ...
10000      23.1            25.1327 ;  ...
7500       24.0            25.1327 ; ...
6000       24.637          25.1327 ;  ...

5000       24.859          25.1327 ;  ...
4500       25.1912         25.1327 ; ...
3000       24.154          25.1327 ; ...
2500       24.645          25.1327 ;  ...
1500       24.8517         25.1327 ; ...
1000       24.8898         25.1327 ] ; 


figure(1000) ; 
hold off
plot(T(:,1)/1000,T(:,2),"or-")
hold on 
yline(25.1327)   
xlabel("Element size (km)")
ylabel("Total flux through fluxgate")
%% Antarctica



%   l                Qn
T=[ ...
     5e3        nan  ; ...
    10e3       1.737  ; ...   
    15e3       1.8457 ; ...
    20e3       1.5257 ; ...
    25e3       1.118  ; ...
    30e3       1.021  ; ...
    40e3       1.05   ; ...
    50e3       1.121  ; ...
    100e3      0.310
    ]   ;

figure(1000) ; plot(T(:,1)/1000,T(:,2),"o-r")
xlabel("mesh size (km)")
ylabel("Qn (Gt/yr)")
xlim([0 100])
%%